<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>ColumnChart</title>
  <link rel="stylesheet" type="text/css" href="style.css"/>
</head>

<body>
<div class="dashboard__charts">
  <div id="orders" class="dashboard__chart_orders"></div>
  <div id="sales" class="dashboard__chart_sales"></div>
  <div id="customers" class="dashboard__chart_customers"></div>
</div>

<script type="module">
  import ColumnChart from './index.js';

  let ordersData = [20];
  let salesData = [30, 40, 20, 80, 35, 15];
  let customersData = [100, 90, 80, 35, 90, 25];

  const ordersChart = new ColumnChart({
    data: ordersData,
    label: 'orders',
    value: 344,
    link: '#'
  });

  const salesChart = new ColumnChart({
    data: salesData,
    label: 'sales',
    value: '$243,437'
  });

  const customersChart = new ColumnChart({
    data: customersData,
    label: 'customers',
    value: 321
  });

  orders.append(ordersChart.element);
  sales.append(salesChart.element);
  customers.append(customersChart.element);


  let diff = [0.03, 0.05, 0.15, 0.08, 0.01, 0.12, 0.1, 0.2, 0.35];

  setInterval(() => {
    if (Math.random() > .9) salesData = salesData.slice(-5);
    if (Math.random() > .9) ordersData = ordersData.slice(-5);
    if (Math.random() > .9) customersData = customersData.slice(-5);
    updateChart(salesData, salesChart, "$")
    updateChart(ordersData, ordersChart)
    updateChart(customersData, customersChart);
  }, 300);

  function updateChart(salesData, salesChart, valPrefix = "") {
    if (salesData.length >= 20) salesData.shift();
    let l = salesData[salesData.length - 1];
    if (!l) {
      l = Math.random() * 100;
    }

    let k = diff[Math.floor(Math.random() * (diff.length - 1))];
    let newVal = l + (l * (Math.random() >= 0.5 ? -k : k));
    salesData.push(Math.floor(newVal));
    salesChart.update(salesData);
    salesChart.setValue(valPrefix + salesData.reduce((a, b) => a + b, 0));
  }
</script>
</body>
</html>
